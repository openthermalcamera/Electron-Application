// This file is required by the index.html file and will
// be executed in the renderer process for that window.
// All of the Node.js APIs are available in this process.

const serialport = require('serialport')
const otc = require('otc')
const otcCanvas = document.getElementById("otc-canvas");
var ctx = otcCanvas.getContext("2d");
otcCanvas.style.webkitFilter = "blur(10px)";
const IR_WIDTH = 32;
const IR_HEIGHT = 24;
var canWidth = otcCanvas.width;
var canHeight = otcCanvas.height;
var pixelWidth = canWidth/IR_WIDTH;
var pixelHeight = canHeight/IR_HEIGHT;

function newData(data){
  var maxTemp = -200;
  var minTemp = 400;
  for(var i = 0; i < data.length; i++){
    if(data[i] == null) continue;
    if(data[i] > maxTemp) maxTemp = data[i];
    if(data[i] < minTemp) minTemp = data[i];
  }
  
	for(var i = 0; i < data.length; i++){
		if(data[i] == null) continue;
      var y = parseInt(i/IR_WIDTH);
      var x = i % IR_WIDTH;
      ctx.fillStyle = getColor(data[i], minTemp, maxTemp);
      ctx.fillRect(pixelWidth*x, pixelHeight*y, pixelWidth, pixelHeight);
		}
}

otc.connect().then(function(){
  otc.setCallbackForNewData(newData);
  otc.setRefreshRate(otc.refreshRate.HZ_16).then(function(data){
    console.log('refresh period set!')
  })
  otc.setAutoFrameSending(otc.autoFrameSending.ENABLED).then(function(data){
    console.log('Auto frame sending enabled');
  })
  otc.setMode(otc.scanMode.CHESS).then(function(){
    console.log('scan mode set!')
  })
})


function getColor(temperature, minimumTemperature, maximimumTemperature){
  var lookup = Math.round(((temperature - minimumTemperature) / (maximimumTemperature - minimumTemperature)) * 1023);
  lookup = Math.min(lookup, 1023)
  lookup = Math.max(lookup, 0)
  
  return lut[Math.abs(lookup-1023)];
}
//lookup table
const lut = [
  "#263923","#263924","#263825","#253825","#253826","#243827","#243828","#233729","#23372A","#23372B","#22372C","#21372D","#21362E","#21362F","#203630","#203631",
  "#203632","#1F3632","#1F3633","#1E3534","#1E3535","#1E3536","#1D3537","#1D3538","#1C3539","#1C353A","#1C353B","#1B353C","#1B343D","#1A343E","#1A343F","#1A3440",
  "#193441","#193442","#183443","#183444","#183445","#183446","#173447","#173448","#163449","#16334A","#16334B","#16334C","#15334C","#15334D","#15334E","#15334F",
  "#143350","#143351","#143352","#133353","#133354","#133355","#123356","#123357","#123358","#123458","#123459","#11345A","#11345B","#11345C","#10345D","#10345E",
  "#10345F","#103460","#103461","#F3462","#F3463","#F3464","#F3465","#E3465","#E3566","#E3567","#E3568","#E3569","#E356A","#D356B","#D356C","#D356D",
  "#D366E","#D366F","#C3670","#C3671","#C3672","#C3673","#C3774","#C3775","#C3776","#B3776","#B3777","#B3778","#B3879","#B387A","#B387B","#B387C",
  "#B397D","#B397E","#A397E","#A397F","#A3980","#A3A81","#A3A82","#A3A83","#A3A84","#A3B85","#A3B86","#A3B87","#A3C88","#A3C89","#A3C8A","#A3C8B",
  "#A3D8B","#A3D8C","#A3D8D","#A3E8E","#A3E8F","#93E90","#93F91","#93F92","#93F93","#A3F93","#A4094","#A4095","#A4196","#A4197","#A4198","#A4298",
  "#A4299","#A429A","#A439B","#A439C","#A439D","#A449D","#A449E","#A449F","#A459F","#A45A0","#A45A1","#A46A2","#A46A3","#A47A3","#B47A4","#B47A5",
  "#B48A5","#B48A6","#B48A7","#B49A8","#B49A9","#B4AA9","#B4AAA","#B4AAB","#C4BAB","#C4BAC","#C4CAD","#C4CAE","#C4DAF","#C4DB0","#C4EB0","#D4EB1",
  "#D4FB2","#D4FB3","#D50B4","#D50B5","#E51B5","#E51B6","#E52B7","#E52B8","#E53B9","#F53B9","#F53BA","#F54BA","#F54BB","#F55BB","#F55BC","#1056BD",
  "#1056BE","#1057BE","#1057BF","#1158C0","#1159C1","#1159C2","#115AC2","#125AC3","#125BC3","#125BC4","#125CC5","#135CC5","#135CC6","#135DC6","#135DC7","#135EC7",
  "#135EC8","#145EC8","#145FC9","#1460CA","#1560CA","#1560CB","#1561CB","#1561CC","#1562CC","#1662CC","#1662CD","#1663CD","#1663CE","#1664CE","#1764CF","#1765D0",
  "#1866D1","#1867D2","#1968D3","#1968D4","#1969D4","#1A69D4","#1A6AD5","#1A6BD6","#1B6BD6","#1B6BD7","#1B6CD7","#1C6DD8","#1C6ED9","#1D6ED9","#1D6FDA","#1D70DB",
  "#1E70DB","#1E71DB","#1E71DC","#1F71DC","#1F72DD","#1F73DD","#2073DE","#2074DE","#2074DF","#2175DF","#2175E0","#2176E0","#2276E0","#2277E1","#2277E2","#2378E2",
  "#2379E3","#2479E3","#247AE3","#247AE4","#257BE4","#257BE5","#257CE5","#267CE5","#267DE6","#277EE6","#277EE7","#277FE7","#287FE8","#2880E8","#2981E9","#2982E9",
  "#2A82EA","#2A83EA","#2B83EB","#2B84EB","#2C85EC","#2C86EC","#2D86ED","#2D87ED","#2E87ED","#2E88EE","#2F89EE","#2F89EF","#2F8AEF","#308AEF","#308AF0","#308BF0",
  "#318BF0","#318CF0","#318CF1","#328DF1","#328EF1","#338EF2","#338FF2","#348FF3","#3490F3","#3591F3","#3591F4","#3592F4","#3692F4","#3693F5","#3793F5","#3794F5",
  "#3894F5","#3895F6","#3996F6","#3996F7","#3A97F7","#3A98F7","#3B98F7","#3B99F8","#3C99F8","#3C9AF8","#3D9AF9","#3D9BF9","#3E9CF9","#3E9DFA","#3F9DFA","#3F9EFA",
  "#409EFA","#409FFB","#419FFB","#41A0FB","#42A1FB","#42A1FC","#43A2FC","#44A3FC","#44A3FD","#45A4FD","#45A5FD","#46A5FD","#46A6FE","#47A6FE","#47A7FE","#48A7FE",
  "#48A8FE","#49A8FF","#49A9FF","#4AA9FF","#4AAAFF","#4BABFF","#4CABFF","#4CACFF","#4DADFF","#4EAEFF","#4FAFFF","#50B0FF","#50B1FF","#51B1FF","#52B2FF","#52B3FF",
  "#53B3FF","#54B4FF","#54B5FF","#55B5FF","#55B6FF","#56B6FF","#56B7FF","#57B7FF","#57B8FF","#58B8FF","#58B9FF","#59B9FF","#59BAFF","#5ABAFF","#5BBBFF","#5BBCFF",
  "#5CBCFF","#5DBDFF","#5DBEFF","#5EBEFF","#5FBFFF","#60C0FF","#61C1FF","#62C2FF","#63C3FF","#64C3FF","#64C4FF","#65C4FF","#65C5FF","#66C5FF","#66C6FF","#67C6FF",
  "#67C7FF","#68C7FF","#68C8FF","#69C8FF","#6AC9FF","#6BCAFF","#6CCBFF","#6DCBFF","#6DCCFF","#6ECCFF","#6ECDFF","#6FCDFF","#70CEFF","#70CFFF","#71CFFF","#72D0FF",
  "#73D1FF","#74D1FF","#74D2FF","#75D2FF","#75D3FF","#76D3FF","#77D4FF","#78D4FF","#78D5FF","#79D5FF","#79D6FF","#7AD6FF","#7BD7FF","#7CD8FF","#7DD8FF","#7DD9FF",
  "#7ED9FF","#7EDAFF","#7FDAFF","#80DBFF","#81DBFF","#81DCFF","#82DCFF","#83DDFF","#84DDFF","#84DEFF","#85DEFF","#86DFFF","#87DFFF","#87E0FF","#88E0FF","#89E1FF",
  "#8AE2FF","#8BE2FF","#8CE3FF","#8DE4FF","#8EE4FF","#8FE5FF","#90E5FF","#90E6FF","#91E6FF","#92E7FF","#93E7FE","#94E8FE","#95E8FE","#95E9FE","#96E9FD","#97E9FD",
  "#97EAFD","#98EAFD","#98EAFC","#99EBFC","#9AEBFC","#9AEBFB","#9BECFB","#9CECFB","#9CEDFB","#9DEDFA","#9EEDFA","#9EEEFA","#9FEEF9","#A0EEF9","#A0EFF9","#A1EFF8",
  "#A2EFF8","#A2F0F8","#A3F0F7","#A4F0F7","#A4F1F7","#A5F1F6","#A6F1F6","#A7F1F5","#A7F2F5","#A8F2F5","#A9F2F4","#A9F3F4","#AAF3F4","#AAF3F3","#ABF3F3","#ABF4F3",
  "#ACF4F2","#ADF4F2","#ADF4F1","#AEF4F1","#AEF5F1","#AFF5F0","#B0F5F0","#B0F5EF","#B1F6EF","#B2F6EF","#B2F6EE","#B3F6EE","#B4F6ED","#B4F7ED","#B5F7ED","#B5F7EC",
  "#B6F7EC","#B6F7EB","#B7F7EB","#B7F8EB","#B8F8EA","#B9F8EA","#B9F8E9","#BAF8E9","#BAF8E8","#BBF9E8","#BCF9E7","#BDF9E6","#BEF9E6","#BEF9E5","#BFF9E5","#BFFAE4",
  "#C0FAE4","#C0FAE3","#C1FAE3","#C1FAE2","#C2FAE2","#C3FAE1","#C4FAE0","#C5FAE0","#C5FADF","#C5FBDF","#C6FBDF","#C6FBDE","#C7FBDE","#C7FBDD","#C8FBDD","#C8FBDC",
  "#C9FBDC","#C9FBDB","#CAFBDB","#CAFBDA","#CBFBDA","#CBFBD9","#CCFBD9","#CCFBD8","#CDFBD8","#CDFBD7","#CEFBD7","#CEFBD6","#CFFBD6","#CFFBD5","#D0FBD5","#D0FBD4",
  "#D1FBD4","#D1FBD3","#D2FBD3","#D2FBD2","#D3FBD1","#D4FBD0","#D5FBCF","#D5FBCE","#D6FBCE","#D6FBCD","#D6FACD","#D7FACC","#D8FACB","#D8FACA","#D9FACA","#D9FAC9",
  "#DAFAC9","#DAFAC8","#DBFAC8","#DBFAC7","#DBFAC6","#DCF9C6","#DCF9C5","#DDF9C5","#DDF9C4","#DEF9C4","#DEF9C3","#DFF9C2","#DFF8C1","#E0F8C1","#E0F8C0","#E1F8BF",
  "#E1F8BE","#E2F8BE","#E2F8BD","#E2F7BD","#E3F7BD","#E3F7BC","#E3F7BB","#E4F7BB","#E4F7BA","#E5F6BA","#E5F6B9","#E5F6B8","#E6F6B8","#E6F6B7","#E7F6B6","#E7F5B6",
  "#E7F5B5","#E8F5B5","#E8F5B4","#E8F5B3","#E9F4B3","#E9F4B2","#EAF4B1","#EAF3B0","#EBF3AF","#EBF3AE","#ECF3AE","#ECF2AE","#ECF2AD","#EDF2AC","#EDF2AB","#EDF1AB",
  "#EEF1AA","#EEF1A9","#EFF0A9","#EFF0A8","#EFF0A7","#F0EFA6","#F0EFA5","#F1EFA4","#F1EEA4","#F1EEA3","#F2EEA2","#F2EDA2","#F2EDA1","#F3EDA1","#F3EDA0","#F3EC9F",
  "#F4EC9E","#F4EB9D","#F5EB9C","#F5EA9B","#F5EA9A","#F6EA9A","#F6E999","#F6E998","#F7E898","#F7E897","#F7E896","#F7E796","#F8E795","#F8E794","#F8E694","#F8E693",
  "#F9E693","#F9E692","#F9E592","#F9E591","#FAE590","#FAE490","#FAE48F","#FAE38E","#FBE38E","#FBE38D","#FBE28C","#FBE28B","#FCE18B","#FCE18A","#FCE189","#FCE089",
  "#FDE088","#FDDF87","#FDDF86","#FDDE86","#FEDE85","#FEDE84","#FEDD84","#FEDD83","#FFDC82","#FFDC81","#FFDB81","#FFDB80","#FFDA7F","#FFDA7E","#FFD97E","#FFD97D",
  "#FFD87C","#FFD87B","#FFD77B","#FFD77A","#FFD679","#FFD678","#FFD578","#FFD577","#FFD476","#FFD475","#FFD375","#FFD374","#FFD273","#FFD172","#FFD171","#FFD071",
  "#FFD070","#FFCF6F","#FFCF6E","#FFCE6E","#FFCE6D","#FFCD6D","#FFCD6C","#FFCC6B","#FFCB6A","#FFCB69","#FFCA69","#FFCA68","#FFC967","#FFC866","#FFC865","#FFC765",
  "#FFC764","#FFC664","#FFC663","#FFC562","#FFC461","#FFC460","#FFC360","#FFC35F","#FFC25F","#FFC25E","#FFC15D","#FFC05C","#FFBF5B","#FFBF5A","#FFBE5A","#FFBE59",
  "#FFBD58","#FFBC57","#FFBC56","#FFBB56","#FFBB55","#FFBA55","#FFBA54","#FFB954","#FFB953","#FFB852","#FFB751","#FFB650","#FFB54F","#FFB54E","#FFB44E","#FFB44D",
  "#FFB34D","#FFB34C","#FFB24C","#FFB24B","#FFB14B","#FFB14A","#FFB049","#FFAF48","#FFAE47","#FFAD47","#FFAD46","#FFAC46","#FFAC45","#FFAB45","#FFAB44","#FFAA43",
  "#FFA942","#FFA841","#FFA740","#FFA63F","#FFA53E","#FFA43D","#FFA33C","#FFA23B","#FFA13A","#FFA139","#FFA039","#FFA038","#FF9F38","#FF9F37","#FF9E37","#FF9E36",
  "#FF9D36","#FF9C35","#FF9B34","#FF9A33","#FF9932","#FF9831","#FF9730","#FF962F","#FF952E","#FF942E","#FF942D","#FF932D","#FF932C","#FF922C","#FF922B","#FF912B",
  "#FF912A","#FF902A","#FF9029","#FF8F29","#FF8F28","#FF8E28","#FF8D27","#FF8C26","#FF8B25","#FF8A25","#FF8A24","#FF8924","#FF8923","#FF8823","#FF8722","#FF8621",
  "#FF8520","#FF841F","#FF831F","#FF831E","#FF821E","#FF821D","#FF811D","#FF811C","#FF801C","#FF7F1B","#FF7E1A","#FF7D19","#FF7C19","#FF7B18","#FF7A17","#FF7917",
  "#FF7916","#FF7816","#FF7815","#FF7715","#FF7714","#FF7614","#FF7513","#FF7412","#FF7312","#FF7311","#FF7211","#FF7110","#FF7010","#FF700F","#FF6F0F","#FF6F0E",
  "#FF6E0E","#FF6D0D","#FF6C0C","#FF6B0C","#FF6B0B","#FF6A0B","#FF690A","#FF680A","#FF6809","#FF6709","#FF6608","#FF6508","#FF6507","#FF6407","#FF6406","#FF6306",
  "#FF6205","#FF6105","#FF6104","#FF6004","#FF5F03","#FF5E03","#FF5E02","#FF5D02","#FF5C01","#FF5B01","#FF5B00","#FF5A00","#FF5900","#FF5800","#FF5700","#FF5600",
  "#FE5500","#FE5400","#FE5300","#FE5200","#FD5200","#FD5100","#FD5000","#FD4F00","#FC4F00","#FC4E00","#FC4D00","#FC4C00","#FB4C00","#FB4B00","#FB4A00","#FB4900",
  "#FA4900","#FA4800","#FA4700","#F94600","#F94500","#F94400","#F84300","#F84200","#F84100","#F74100","#F74000","#F73F00","#F63E00","#F63D00","#F63C00","#F53C00",
  "#F53B00","#F53A00","#F43900","#F43800","#F43700","#F33700","#F33600","#F33500","#F23500","#F23400","#F23300","#F13200","#F13100","#F03100","#F03000","#F02F00",
  "#EF2E00","#EF2D00","#EE2C00","#EE2B00","#ED2A00","#ED2900","#EC2800","#EC2700","#EB2700","#EB2600","#EB2500","#EA2500","#EA2400","#EA2300","#E92300","#E92200",
  "#E82100","#E82000","#E72000","#E71F00","#E71E00","#E61E00","#E61D00","#E51C00","#E51B00","#E41B00","#E41A00","#E31900","#E31800","#E21800","#E21700","#E21600",
  "#E11600","#E11500","#E01500","#E01400","#DF1300","#DF1200","#DE1200","#DE1100","#DD1100","#DD1000","#DC0F00","#DB0E00","#DB0D00","#DA0D00","#DA0C00","#D90C00",
  "#D90B00","#D80B00","#D80A00","#D70A00","#D70900","#D60900","#D60800","#D50800","#D50700","#D40700","#D40600","#D30600","#D30500","#D20500","#D20400","#D10400",
  "#D10300","#D00300","#D00200","#CF0200","#CE0100","#CD0100","#CD0000","#CC0000","#CB0000","#CA0000","#C90000","#C80000","#C70000","#C60000","#C50000","#C40000",
  "#C30000","#C20000","#C10000","#C00000","#BF0000","#BE0000","#BD0000","#BC0000","#BB0000","#BA0000","#B90000","#B80000","#B70000","#B60000","#B50000","#B40001",
  "#B40002","#B30002","#B30003","#B20004","#B20005","#B10005","#B10006","#B00007","#B00008","#AF0009","#AF000A","#AE000A","#AE000B","#AD000C","#AD000D","#AC000E",
  "#AC000F","#AB000F","#AB0010","#AA0011","#AA0012","#A90013","#A90014","#A80015","#A80016","#A70017","#A70018","#A60019","#A6001A","#A5001B","#A5001C","#A4001D"];


